#+TITLE: Zenn Book = One Org File
#+OPTIONS: toc:nil
#+GFM_TAGS: org
#+GFM_CUSTOM_FRONT_MATTER: :emoji ğŸ—¿ :type tech
#+GFM_CUSTOM_FRONT_MATTER: :published true

* èƒŒæ™¯

#+ATTR_HTML: :x-type message
#+BEGIN_QUOTE
[[https://vim-jp.org/ekiden/][Vim é§…ä¼]] 2025/06/18 ã®æŠ•ç¨¿ã§ã™ã€‚å‰å›ã®è¨˜äº‹ã¯ sinotca ã•ã‚“ã® [[https://zenn.dev/sinotca/articles/6bf254d056af28][Excel ãƒã‚¯ãƒ­ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚’ä½œã‚ã†ï¼]] ã§ã—ãŸã€‚
#+END_QUOTE

Zenn ãƒ¦ãƒ¼ã‚¶ã®çš†æ§˜ã¯ [[https://zenn.dev/zenn/articles/zenn-cli-guide][=zenn-cli=]] ã‚’ä½¿ã„ã€å¿«é©ãªåŸ·ç­†ç”Ÿæ´»ã‚’é€ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚åƒ•ã‚‚ =zenn-cli= ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è‰¯ã•ãŒå¥½ãã§ã€æº€è¶³åº¦ã®é«˜ã„ç”Ÿæ´»ã‚’é€ã£ã¦ã„ã¾ã—ãŸã€‚

ãŸã ã€æœ¬ã¯ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãŒå¢—ãˆã‚‹ã¨ç®¡ç†ãŒå¤§å¤‰ã«ãªã‚Šã¾ã—ãŸã€‚ç‰¹ã«è¨˜äº‹ä¸€è¦§ã®è¡¨ç¤ºæ–¹æ³•ãŒ 3 ç¨®é¡ã«ãªã£ã¦æ··ä¹±ã—ã¾ã™:

| è¡¨ç¤ºç®‡æ‰€        | è¡¨ç¤ºå½¢å¼             | ä¸¦ã³           |
|----------------+---------------------+----------------|
| Zenn ã‚µã‚¤ãƒ‰ãƒãƒ¼ | ã‚¿ã‚¤ãƒˆãƒ«             | ãƒãƒ£ãƒ—ã‚¿ãƒ¼é †     |
| =config.yaml= | ãƒ•ã‚¡ã‚¤ãƒ«å (=.md= ç„¡ã—) | ãƒãƒ£ãƒ—ã‚¿ãƒ¼é †     |
| ã‚¨ãƒ‡ã‚£ã‚¿        | ãƒ•ã‚¡ã‚¤ãƒ«å           | ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé † |

ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒ 20 ã‚’è¶…ãˆã‚‹ã¨ã€ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®ç§»å‹•ãŒã¾ã¾ãªã‚‰ãªããªã‚Šã¾ã™ã€‚å°‘ãªãã¨ã‚‚ã€ [[https://www.kadokawa.co.jp/product/311865500010/][æ€è€ƒã®é€Ÿåº¦ã§ç·¨é›†]] ã§ããªã„ç’°å¢ƒã§ã™ã€‚

ã“ã® 3 ã¤ã®ä¸¦ã³ã‚’ä¸€å…ƒåŒ–ã§ããªã„ã‹è€ƒãˆãŸæ™‚ã« [[https://github.com/conao3/ox-zenn.el][=ox-zenn.el=]] ã¨å‡ºä¼šã„ã¾ã—ãŸã€‚

** Zenn Book ã®è¦‹å‡ºã—ã«ã¤ã„ã¦

[[https://github.com/conao3/ox-zenn.el][=ox-zenn.el=]]  ã¯ Org ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã§ãã¾ã™ã€‚ã¾ãŸ Org ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€éƒ¨ (/subtree/) ã‚’ Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ 1 ã¤ã® Org ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¨ã¦ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã‚’åç´ã—ã€ Org ã‹ã‚‰ =config.yaml= ã‚„ =*.md= ã‚’å±•é–‹ã§ãã¾ã™ã€‚

ã“ã‚Œã‚’æ´»ã‹ã›ã°ã€ã‚¨ãƒ‡ã‚£ã‚¿ã¨ãƒ–ãƒ©ã‚¦ã‚¶é–“ã§è¦‹å‡ºã—ã®å†…å®¹ãŒä¸€è‡´ã™ã‚‹ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ =config.yaml= ã‚‚æ‰‹å‹•ã§ç·¨é›†ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“:

#+BEGIN_EXPORT md
![headings](/images/org-zenn-headings.png)
#+END_EXPORT

å®Ÿéš› [[https://zenn.dev/toyboot4e/books/kyopro-bonsai-hs][ç«¶ãƒ—ãƒ­ç›†æ ½.hs]] ã¯ Org ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚ã“ã†ã—ãŸç’°å¢ƒã®ä½œã‚Šæ–¹ã‚’ç´¹ä»‹ã—ã¦è¡Œã“ã†ã¨æ€ã„ã¾ã™ã€‚

** å‚™è€ƒ. Org ã¨ã¯

Org ã¯ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã§ã™ã€‚ä¸»ã« Emacs ã§ä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€ä»–ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§ã¯äººæ°—ãŒé«˜ãã‚ã‚Šã¾ã›ã‚“ã€‚ç†ç”±ã®ä¸€ç«¯ã¯ã€ Emacs ã«ãŠã‘ã‚‹ Org ã®å®Ÿè£… (=org-mode=) ãŒã‚ã¾ã‚Šã«ã‚‚é‡åšéãã¦ã€ç§»æ¤ç‰ˆã®å®Ÿè£…ãŒè¿½ã„ã¤ã‹ãªã„ãŸã‚ã ã¨æ€ã„ã¾ã™ã€‚

ã—ã‹ã— Emacs ä»¥å¤–ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§ã‚‚ã€ Org ã‚’æ™®é€šã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã¨ã—ã¦ä½¿ã†ã“ã¨ã¯ã§ãã¾ã™ã€‚èª°ã§ã‚‚æ°—å…¼ã­ãªã Org ã‚’ä½¿ãˆã‚‹é¢¨æ½®ã«ãªã‚Œã°è‰¯ã„ãªã¨æ€ã„ã¾ã™ã€‚

** ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«

ä»Šå›ä½œæˆã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã«ä¿å­˜ã—ã¦ã„ã¾ã™:

#+BEGIN_EXPORT md
https://github.com/toyboot4e/org-zenn-example
#+END_EXPORT

#+ATTR_HTML: :x-type message
#+BEGIN_QUOTE
Windows ã§ã¯å‹•ä½œæœªç¢ºèªã§ã™ã€‚
#+END_QUOTE

* =emacs= ã‚³ãƒãƒ³ãƒ‰ã®å°å…¥

ä»Šå›ã¯ã‚¨ãƒ‡ã‚£ã‚¿ã«ä¾å­˜ã—ãªã„ Zenn åŸ·ç­†ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã‹ã‚‰ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã¨ã—ã¦ã® Emacs ã¯å°å°ã—ã¾ã™ã€‚ä»£ã‚ã‚Šã« =emacs= ã‚³ãƒãƒ³ãƒ‰ã‚’ ELisp (Emacs Lisp) ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

=emacs= ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã¨ã—ã¦é€²ã‚ã¦è¡Œãã¾ã™ã€‚

** ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

é€šå¸¸ã€ =zenn-cli= ã¯æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ä½œæˆã—ã¾ã™:

#+BEGIN_SRC txt
.
â”œâ”€â”€ articles/
â”‚   â””â”€â”€ my-article.md
â””â”€â”€ books/my-book/
    â”œâ”€â”€ config.yaml
    â”œâ”€â”€ example1.md
    â””â”€â”€ example2.md
#+END_SRC

ä»Šå›ã¯ Org ãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨ã®ãŸã‚ã€ä»¥ä¸‹ã®æ§‹æˆã‚’è¿½åŠ ã—ã¾ã™:

#+BEGIN_SRC txt
.
â”œâ”€â”€ org-articles/
â”‚   â””â”€â”€ my-org-article.org
â”œâ”€â”€ org-books/
â”‚   â””â”€â”€ my-org-book.org
â””â”€â”€ elisp/
    â”œâ”€â”€ cat.el
    â”œâ”€â”€ export-org-article.el
    â””â”€â”€ export-org-book.el
#+END_SRC

- =org-articles/=: Org ã§æ›¸ãè¨˜äº‹ã‚’ä¿å­˜ã—ã¾ã™ã€‚
- =org-books/= Org ã§æ›¸ãæœ¬ã‚’ä¿å­˜ã—ã¾ã™ã€‚
- =elisp/=: Org, Markdown é–“ã®å¤‰æ›ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã™ã€‚

** Hello, ELisp!

=emacs= ã¯æ¬¡ã®å½¢ã§ ELisp ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™:

#+BEGIN_SRC sh
$ emacs --quick --script <ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«>
#+END_SRC

- [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Initial-Options.html#index-_002d_002dquick][-Q, --quick]]
- [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Initial-Options.html#index-_002d_002dscript][--batch]]

ãŸã¨ãˆã°å¼•æ•°æŒ‡å®šã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã£ã¦ã¿ã¾ã™:

#+BEGIN_EXPORT md
```elisp:elisp/cat.el
(with-temp-buffer
  (insert-file-contents (car argv))
  (princ (buffer-string)))
```
#+END_EXPORT

ã“ã‚Œã¯æ¬¡ã®ã‚ˆã†ãª ELisp ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™:

- ç©ºã®ä¸€æ™‚ãƒãƒƒãƒ•ã‚¡ã‚’ä½œæˆã™ã‚‹
- å¼•æ•°æŒ‡å®šã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ãƒãƒƒãƒ•ã‚¡ã«æµã—è¾¼ã‚€
- ãƒãƒƒãƒ•ã‚¡ã®å†…å®¹ã‚’å‡ºåŠ›ã™ã‚‹

=emacs= ã¯è‡ªåˆ†ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã ã¨æ€ã„è¾¼ã‚“ã§ã„ã‚‹ã®ã§ã€å¥‡å¦™ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã£ã¦ã€ =./org-articles/my-org-article.org= ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã™:

#+BEGIN_SRC sh
$ emacs --quick --script elisp/cat.el ./org-articles/my-org-article.org
#+TITLE: Org Article
#+GFM_TAGS: org
#+GFM_CUSTOM_FRONT_MATTER: :emoji ğŸ—¿ :type tech
<ç•¥>
#+END_SRC

ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’è¡¨ç¤ºã§ãã¾ã—ãŸã€‚ =cat.el= å®Œæˆã§ã™ ğŸ±

** è¨˜äº‹ã‚’ export ã™ã‚‹

æ¬¡ã¯ Org ãƒ•ã‚¡ã‚¤ãƒ«è£½ã®è¨˜äº‹ã‚’ Markdown ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚å…·ä½“ä¾‹ã¨ã—ã¦ã¯ã€ =org-articles/file.org= ã«é©ç”¨ã™ã‚‹ã¨ =articles/file.md= ã‚’ç”Ÿæˆã—ã¾ã™ã€‚è¨˜äº‹ã‚’ Org ã§æ›¸ããƒ¡ãƒªãƒƒãƒˆã¯ã‚ã¾ã‚Šç„¡ã„ã§ã™ãŒã€ç·´ç¿’ã«ã¯ã¡ã‚‡ã†ã©è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚

åƒ•ã¯ Emacs ãƒªãƒ†ãƒ©ã‚·ãƒ¼ãŒé«˜ããªã„ã®ã§ã€ AI ã«èããªãŒã‚‰ path ã‚’æ•´ç†ã—ã¾ã—ãŸ:

#+BEGIN_EXPORT md
```elisp:elisp/export-org-article.el
(with-temp-buffer
  (insert-file-contents (car argv))
  (let* (;; */zenn/org-articles/my-org-article.md
         (src-file (expand-file-name (car argv)))
         ;; */zenn/org-articles
         (org-dir (file-name-directory src-file))
         ;; */zenn
         (zenn-dir (file-name-directory (directory-file-name org-dir)))
         ;; */zenn/articles/
         (article-dir (concat zenn-dir "articles/"))
         ;; my-org-article
         (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md"))
         ;; */zenn/articles/my-org-article.md
         (dst-path (concat article-dir file-name)))
    ;; (org-export-to-file 'zennmd outfile)
    (print src-file)
    (print org-dir)
    (print zenn-dir)
    (print article-dir)
    (print file-name)
    (print dst-path)))
```
#+END_EXPORT

=print= å‡ºåŠ›ã‚’è¦‹ã‚‹ãŸã‚ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã™:

#+BEGIN_SRC elisp
$ emacs -Q --script export-org-article.el org-articles/org-article.org
#+END_SRC

#+BEGIN_SRC txt
"/home/tbm/dev/hs/org/org-zenn-example/org-articles/my-org-article.org"

"/home/tbm/dev/hs/org/org-zenn-example/org-articles/"

"/home/tbm/dev/hs/org/org-zenn-example/"

"/home/tbm/dev/hs/org/org-zenn-example/articles/"

"my-org-article.md"

"/home/tbm/dev/hs/org/org-zenn-example/articles/my-org-article.md"
#+END_SRC

å…ˆé ­ã€æœ«å°¾ã§å¤‰æ›å…ƒã€å¤‰æ›å…ˆã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒå–ã‚Œã¦ã„ã¾ã™:

- ="/home/tbm/dev/hs/org/org-zenn-example/org-articles/my-org-article.org"=
- ="/home/tbm/dev/hs/org/org-zenn-example/article/my-org-article.md"=

å¾Œã¯ =org-export-to-file= ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã—ã™ã‚Œã° OK ã§ã™:

#+BEGIN_SRC elisp
;; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
(eval-and-compile
  (customize-set-variable
   'package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                       ("melpa" . "https://melpa.org/packages/")
                       ("org" . "https://orgmode.org/elpa/")))
  (package-initialize))

(use-package org
  :ensure t)

(use-package ox-zenn
   :ensure t)

(require 'org)
(require 'ox-zenn)

;; ãƒ‘ã‚¹ã®æ•´ç†
(with-temp-buffer
  (insert-file-contents (car argv))
  (let* (;; */zenn/org-articles/my-org-article.md
         (src-file (expand-file-name (car argv)))
         ;; */zenn/org-articles
         (org-dir (file-name-directory src-file))
         ;; */zenn
         (zenn-dir (file-name-directory (directory-file-name org-dir)))
         ;; */zenn/articles/
         (article-dir (concat zenn-dir "articles/"))
         ;; my-org-article
         (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md"))
         ;; */zenn/articles/my-org-article.md
         (dst-path (concat article-dir file-name)))
    ;; (print src-file)
    ;; (print org-dir)
    ;; (print zenn-dir)
    ;; (print article-dir)
    ;; (print file-name)
    ;; å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º
    (print dst-path)
    ;; export å®Ÿè¡Œ
    (org-export-to-file 'zennmd dst-path)))
#+END_SRC

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨:

#+BEGIN_SRC sh
$ emacs -Q --script export-org-article.el org-articles/org-article.org
#+END_SRC

ç„¡äº‹ã« =articles/my-org-article.md= ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ =export-org-article.el= å®Œæˆã§ã™ã€‚å¾Œã¯ [[https://github.com/watchexec/watchexec][=watchexec=]] ç­‰ã§ =.org=, =.md= é–“ã‚’åŒæœŸã™ã‚Œã°ã€ Zenn ã®è¨˜äº‹ãŒ Org ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#+BEGIN_QUOTE
æ³¨æ„ç‚¹ã¨ã—ã¦ã€ Org ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒªãƒ³ã‚¯ãƒŸã‚¹ç­‰ãŒã‚ã‚‹ã¨ã€è†¨å¤§ãªã‚¨ãƒ©ãƒ¼å‡ºåŠ›ãŒå‡ºã¾ã™:

#+BEGIN_SRC txt
<ä¸­ç•¥>
(file-name-nondirectory src-file)) ".md")) (dst-path (concat article-dir file-name))) (print dst-path) (org-export-to-file 'zennmd dst-path))
  (progn (insert-file-contents (car argv)) (let* ((src-file (expand-file-name (car argv))) (org-dir (file-name-directory src-file)) (zenn-dir (file-name-directory (directory-file-name org-dir))) (article-dir (concat zenn-dir "articles/")) (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md")) (dst-path (concat article-dir file-name))) (print dst-path) (org-export-to-file 'zennmd dst-path)))
  (unwind-protect (progn (insert-file-contents (car argv)) (let* ((src-file (expand-file-name (car argv))) (org-dir (file-name-directory src-file)) (zenn-dir (file-name-directory (directory-file-name org-dir))) (article-dir (concat zenn-dir "articles/")) (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md")) (dst-path (concat article-dir file-name))) (print dst-path) (org-export-to-file 'zennmd dst-path))) (and (buffer-name temp-buffer) (kill-buffer temp-buffer)))
  (save-current-buffer (set-buffer temp-buffer) (unwind-protect (progn (insert-file-contents (car argv)) (let* ((src-file (expand-file-name (car argv))) (org-dir (file-name-directory src-file)) (zenn-dir (file-name-directory (directory-file-name org-dir))) (article-dir (concat zenn-dir "articles/")) (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md")) (dst-path (concat article-dir file-name))) (print dst-path) (org-export-to-file 'zennmd dst-path))) (and (buffer-name temp-buffer) (kill-buffer temp-buffer))))
  (let ((temp-buffer (generate-new-buffer " *temp*" t))) (save-current-buffer (set-buffer temp-buffer) (unwind-protect (progn (insert-file-contents (car argv)) (let* ((src-file (expand-file-name (car argv))) (org-dir (file-name-directory src-file)) (zenn-dir (file-name-directory (directory-file-name org-dir))) (article-dir (concat zenn-dir "articles/")) (file-name (concat (file-name-sans-extension (file-name-nondirectory src-file)) ".md")) (dst-path (concat article-dir file-name))) (print dst-path) (org-export-to-file 'zennmd dst-path))) (and (buffer-name temp-buffer) (kill-buffer temp-buffer)))))
  #<subr F616e6f6e796d6f75732d6c616d626461_anonymous_lambda_101>(#<buffer  *load*> "/home/tbm/write/zenn/elisp/export-org-article.el")
  load-with-code-conversion("/home/tbm/write/zenn/elisp/export-org-article.el" "/home/tbm/write/zenn/elisp/export-org-article.el" nil t #<subr F616e6f6e796d6f75732d6c616d626461_anonymous_lambda_101>)
  command-line--load-script("/home/tbm/write/zenn/elisp/export-org-article.el")
  command-line-1(("-scriptload" "elisp/export-org-article.el" "org/write-org-for-great-good.org"))
  command-line()
  normal-top-level()
Wrong type argument: char-or-string-p, (verbatim (:standard-properties [1510 nil nil nil 1518 1 nil nil nil nil ...] :value "emacs"))
#+END_SRC

ãƒ­ã‚°ã‚’è¦‹ã‚‹ã®ã‚‚å¤§å¤‰ãªã®ã§ã€äºŒåˆ†æ¢ç´¢ã«ã‚ˆã‚‹è§£æ±ºãŒé€Ÿã„ã¨æ€ã„ã¾ã™ã€‚ Org ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŠåˆ†ãšã¤æ¶ˆã—ã¦åŸå› ã‚’çµã‚Šè¾¼ã‚€ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¡ã‚‡ã£ã¨æ‚²ã—ã„ä½œæ¥­ã§ã™ãŒâ€¦â€¦ã€‚
#+END_QUOTE

** æœ¬ã‚’ export ã™ã‚‹

æœ¬é¡Œã§ã™ã€‚ 1 ã¤ã® Org ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ Zenn Book å…¨ä½“ã‚’å±•é–‹ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚

*** ãƒ‘ã‚¹ã®æ•´ç†

ã“ã¡ã‚‰ã‚‚ãƒ‘ã‚¹ã®æ•´ç†ã‹ã‚‰å…¥ã‚Šã¾ã™ã€‚å¼•æ•°ã¨ã—ã¦ =org-book/my-book.org= (ä¾‹) ã‚’å—ã‘å–ã£ãŸæ™‚ã«ã€ =books/my-book/= ãƒ‘ã‚¹ã‚’ä½œæˆã—ã¾ã™:

#+BEGIN_EXPORT md
```elisp:elisp/export-book.el
(with-temp-buffer
  (insert-file-contents (car argv))
  (let* (;; */zenn/org-books/my-org-book.el
         (src-file (expand-file-name (car argv)))
         ;; */zenn/org-books
         (org-dir (file-name-directory src-file))
         ;; */zenn
         (zenn-dir (file-name-directory (directory-file-name org-dir)))
         ;; my-org-book
         (book-name (file-name-sans-extension (file-name-nondirectory src-file)))
         ;; */zenn/books/my-org-book/
         (book-dir (concat zenn-dir "books/" book-name "/")))
    (print book-dir)))
```
#+END_EXPORT

å®Ÿè¡Œã™ã‚‹ã¨ã€å¤‰æ›å…ˆã® book ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå–ã‚Œã¦ã„ã¾ã™:

#+BEGIN_SRC sh
$ emacs -q --script elisp/export-org-book.el ./org-books/my-org-book.org
"/home/tbm/dev/hs/org/org-zenn-example/books/my-org-book/"
#+END_SRC

- ="/home/tbm/dev/hs/org/org-zenn-example/article/my-org-article/"=

*** ãƒ¬ãƒ™ãƒ« 1 è¦‹å‡ºã—ã‚’èµ°æŸ»ã™ã‚‹

ä»Šå›å¯¾è±¡ã® Org ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€æ¬¡ã®ã‚ˆã†ãªå†…å®¹ã§ã™:

#+BEGIN_SRC org
,#+TITLE: Zenn Book in Org

,* Heading 1

,* TODO Heading 2

,* Heading 3
#+END_SRC

[[https://orgmode.org/manual/Using-the-Mapping-API.html#index-org_002dmap_002dentries][=org-map-entries=]] ã‚’ä½¿ã†ã¨ã€ Org ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸­ã®è¦ç´ ã‚’èµ°æŸ»ã§ãã¾ã™ã€‚

#+BEGIN_SRC elisp
(with-temp-buffer
  (insert-file-contents (car argv))
  (org-mode)
  (org-map-entries
   (lambda ()
     (let ((title (org-entry-get nil "ITEM")))
       (message title)))
   "LEVEL=1")))
#+END_SRC

å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®é€šã‚Šã§ã—ãŸ:

#+BEGIN_SRC sh
$ emacs -q --script elisp/export-org-book.el ./org-books/my-org-book.org
Heading 1
TODO Heading 2
Heading 3
#+END_SRC

Org ã«ã¯è¦‹å‡ºã—ã« [[https://orgmode.org/manual/TODO-Basics.html][TODO]] ã‚’ã¤ã‘ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ =TODO= ä»˜ãã®è¦‹å‡ºã—ã¯ä¸‹æ›¸ãã¨ã¿ãªã—ã€ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã¨ã€ =Heading 2= ã‚’ä¸‹æ›¸ãã¨ã—ã¦çœç•¥ã•ã‚Œã¾ã™:

#+BEGIN_SRC elisp
(org-map-entries
 (lambda ()
   (let ((title (org-entry-get nil "ITEM")))
     (unless (string= (org-get-todo-state) "TODO")
       (message title))))
 "LEVEL=1")
#+END_SRC

#+BEGIN_SRC sh
$ emacs -q --script elisp/export-org-book.el ./org-books/my-org-book.org
Heading 1
Heading 3
#+END_SRC

*** ãƒ¬ãƒ™ãƒ« 1 è¦‹å‡ºã—ã‚’ =.md= ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã™ã‚‹

Org ãƒ•ã‚¡ã‚¤ãƒ«ã« =EXPORT_FILE_NAME= /property/ ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚ãŸã¨ãˆã° =chapter-1= ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ =chapter-1.md= ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™:

#+BEGIN_SRC 
,#+TITLE: Org Book

,* Heading 1
:PROPERTIES:
:EXPORT_FILE_NAME: chapter-1
:END:

ãƒ†ã‚¹ãƒˆ

,* TODO Heading 2
:PROPERTIES:
:EXPORT_FILE_NAME: chapter-2
:END:

ãƒ†ã‚¹ãƒˆ

,* Heading 3
:PROPERTIES:
:EXPORT_FILE_NAME: chapter-3
:END:

ãƒ†ã‚¹ãƒˆ
#+END_SRC

=org-map-entries= ã§ãƒ¬ãƒ™ãƒ« 1 è¦‹å‡ºã—ã‚’èµ°æŸ»ã™ã‚‹ã¨ãã€ =lambda= ä¸­ã§ =org-zenn-export-to-markdown= ã™ã‚‹ã¨ã€ç›¸å¯¾ãƒ‘ã‚¹ã¸ =.md= ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã‚ŒãŒ =book= ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã† =cd= ã—ã¦ãŠã‘ã°ã€ç›®çš„ã®å ´æ‰€ã« =.md= ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™:

#+BEGIN_SRC elisp
(with-temp-buffer
  (insert-file-contents (car argv))
  (org-mode)
  (let* (;; */zenn/org-books/my-org-book.el
         (src-file (expand-file-name (car argv)))
         ;; */zenn/org-books
         (org-dir (file-name-directory src-file))
         ;; */zenn
         (zenn-dir (file-name-directory (directory-file-name org-dir)))
         ;; my-org-book
         (book-name (file-name-sans-extension (file-name-nondirectory src-file)))
         ;; */zenn/books/my-org-book/
         (book-dir (concat zenn-dir "books/" book-name "/")))
    (print book-dir)

    (unless (file-directory-p book-dir)
      (make-directory book-dir t))
    (cd book-dir)

    (org-map-entries
     (lambda ()
       (let ((title (org-entry-get nil "ITEM")))
         (unless (string= (org-get-todo-state) "TODO")
           ;; (message title)
           (org-zenn-export-to-markdown nil t))))
     "LEVEL=1")))
#+END_SRC

#+BEGIN_SRC sh
$ emacs -q --script elisp/export-org-book.el ./org-books/my-org-book.org

$ fd . books/my-org-book | as-tree
books/my-org-book
â”œâ”€â”€ chapter-1.md
â””â”€â”€ chapter-3.md
#+END_SRC

æˆåŠŸã§ã™ï¼ã€€å¾Œã¯ =config.yaml= ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚Œã°ã€ Zenn Book ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ Org ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å±•é–‹ã§ãã¾ã™ã€‚

*** =config.yaml= ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹

æœ€å¾Œã« =config.yaml= ã®ç”Ÿæˆéƒ¨åˆ†ã§ã™ã€‚ Org ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã« =config.yaml= ã‚’åŸ‹ã‚è¾¼ã‚“ã§ãŠãã¾ã™:

#+BEGIN_SRC org
,* TODO ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

,** =config.yaml=

,#+NAME: config.yaml
,#+BEGIN_SRC yaml
title: "My Org Book"
summary: "Greate Org"
topics: ["org"]
published: true
price: 0
chapters:
,#+END_SRC
#+END_SRC

=chapters= ä»¥ä¸‹ã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ç”Ÿæˆã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãª =config.yaml= ãŒå‡ºåŠ›ã•ã‚Œã¾ã™:

#+BEGIN_EXPORT md
```yaml:books/my-org-book/config.yaml
title: "My Org Book"
summary: "Greate Org"
topics: ["org"]
published: true
price: 0
chapters:
- chapter-1
- chapter-3
```
#+END_EXPORT

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ =org-map-entries= ç­‰ã§ã‚´ãƒªã‚´ãƒªå®Ÿè£…ã—ã¾ã™ã€‚è©³ç´°ã¯ [[https://github.com/toyboot4e/org-zenn-example][ãƒªãƒã‚¸ãƒˆãƒª]]= ã® [[https://github.com/toyboot4e/org-zenn-example/blob/main/elisp/export-org-book.el][è©²å½“ã‚¹ã‚¯ãƒªãƒ—ãƒˆ]] ã‚’ã”è¦§ãã ã•ã„ã€‚

#+BEGIN_EXPORT md
![headings](/images/org-zenn-headings.png)
*ç’°å¢ƒæ§‹ç¯‰ã§ãã‚Œã°ã€ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™*
#+END_EXPORT

* çµ‚ã‚ã‚Šã«

Zenn Book ã‚’ Org ã§æ›¸ããŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãŠä½¿ã„ã®ã‚¨ãƒ‡ã‚£ã‚¿ãŒä½•ã§ã‚ã‚Œã€ Org ãƒ•ã‚¡ã‚¤ãƒ«ãŒã”åˆ©ç”¨å¯èƒ½ã§ã™ã€‚å¿«é©ãªåŸ·ç­†ç”Ÿæ´»ã‚’ãŠé€ã‚Šãã ã•ã„ï¼

CLI ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã® Emacs ã®å¯èƒ½æ€§ã«ã‚‚æ³¨ç›®é ‚ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚ä½•ã¦ã“ã¨ã®ãªã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§çµæ§‹ä¾¿åˆ©ã«ãªã£ãŸã¨æ€ã„ã¾ã™ã€‚

Emacs ãƒ—ãƒ­ã®æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã‚Œã°ã€ã‚ã¡ã‚ƒãƒ¼ã¨ã„ã†ç®‡æ‰€ã‚‚ã‚ã£ãŸã¨æ€ã„ã¾ã™ãŒã€ã”å®¹èµ¦ãã ã•ã„ã€‚ãã‚Œã§ã¯ã”ä¸€èª­é ‚ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

** å‚è€ƒ

#+BEGIN_EXPORT md
https://zenn.dev/conao3/articles/ox-zenn-usage
#+END_EXPORT


